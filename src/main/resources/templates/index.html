<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
    <head>
        <meta charset="UTF-8">
        <title>TodoZ-main</title>
        <link rel="stylesheet" href="/new.css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
    </head>
<script th:inline="javascript">

    var messages = [[${messages}]];

    function rotateArray(arr){
        var nextItem = arr.shift();
        arr.push(nextItem);
        return nextItem
    }

    function showNotification() {

        if (Notification.permission === 'granted') {
            const nextMessage = rotateArray(messages);
            new Notification(nextMessage.title,  { body: nextMessage.description });
        } else if (Notification.permission !== 'denied') {
            Notification.requestPermission().then(function (permission) {
                if (permission === 'granted') {
                    showNotification();
                }
            });
        }
    }
    setInterval(showNotification,  10000 );

</script>
<body>
<section class="app home">
    <header>
        <a th:href="@{/longTerm}"> Long term </a>
        <h2 th:text="|Week ${currentWeek.getWeekNumber()}|"></h2>
        <a th:href="@{/weekReview}"> Week review </a>
    </header>

    <main>
        <div class="task" th:each="task : ${currentWeek.getTasks()}">
            <p th:text="${task.getDescription()}"></p>
            <span class="due" th:text="${task.getRemainingDays()}"></span>
            <form th:action="@{/checked/{id}(id=${task.getId()})}" th:method="POST">
                <input type="hidden" th:name="done" th:value="${!task.isDone()}"/>
                <button class="img" th:type="submit">
                    <img th:if="${task.isDone()}" src="/img/vector_img_checkedbox.png" alt="mark as not done"/>
                    <img th:unless="${task.isDone()}" src="/img/vector_img_checkbox.png" alt="mark as done"/>
               </button>
            </form>
        </div>
    </main>

    <footer>
        <form method="post" th:action="@{/add}">
            <div class="stars">
                <button type="submit" name="priority" value="4">üî•</button>
                <button type="submit" name="priority" value="3">‚≠ê</button>
                <button type="submit" name="priority" value="2">üê¢</button>
                <button type="submit" name="priority" value="1">üßä</button>
            </div>

            <label class="dateTime hidden">
                <input type="date" name="maybeDueDate" id="date">
            </label>

            <label class="addTask">
                <input type="text" placeholder="new task" name="description" id="add" required>
                <img onclick="toggleDueDate()" src="/img/Clock_Yellow.png" alt="due date">
            </label>
        </form>
    </footer>

    <script>
        function toggleDueDate() {
            document.querySelector(".dateTime").classList.toggle("hidden");
            document.querySelector("#date").value = "";
        }
    </script>

</section>
</body>
</html>